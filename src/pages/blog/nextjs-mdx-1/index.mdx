---
title: 'Next.jsとMDXで個人ブログを作ってみた'
date: '2021/09/18'
description: 'この記事を読むと誰でも自前の個人ブログを作れるようになることを目指します。(記事のボリュームが想像以上に大きくなったので分割する予定です。)個人ブログや企業のエンジニアブログの...'
author: watsuyo_2
path: 'nextjs-mdx-1'
---

# Next.jsとMDXで個人ブログを作ってみた

## この記事の目標

この記事を読むと誰でも自前の個人ブログを作れるようになることを目指します。(記事のボリュームが想像以上に大きくなったので分割する予定です。)

個人ブログや企業のエンジニアブログのようなものを簡単に作ることができます。

Markdownファイルを、HTMLに変換してWeb上に公開することになるので、実装コードと一緒に記事のMarkdownファイルをGit管理することができます。

## 技術スタックと開発環境

- Next.js 14系
- TypeScript 4.4系
- MDX(MarkdownをHTML化)
- Vercel(デプロイサーバー)
- MaxOS Big Sir 11.5.2

## なんで作ったか？

最新技術で日々メンテナンスが出来るものが作りたかったのが大きいかなと思います。

個人ブログのメインユーザーは、自分自身でありブログを読んでくださる方なので、エンジニアが作るWebサービスの個人開発にも似たような感覚です。

Next.jsを使って見たかったといえば、それまでですが、SSGなWebサイトは2020年代に入ってから特に注目されている分野ですし、試すなら今！みたいな所もありました。

QiitaやZennもありがたく利用していますが、どうしても"いいね"のような数字にとらわれる感じで胃もたれしがちなので、消化の良さそうな個人ブログで胃の中をスッキリさせていこうと思います。

普段はVue.jsを使うことがほとんどなので、React.jsを使うのはどうなの？という点については、全然問題ないです。

ドキュメントや先駆者のブログに大体の答えは書いてあります。

## なんでNext.jsにしたのか？

流行りのフレームワークの勉強をしたかったのと、大きな理由はSSG(Static Site Generation)できるからです。

静的なブログサイトを作るだけのためにSSRやSPAですと、初回レンダリングやSEOに課題があるため(改善方法はありますが)、要件を素早く解消してくれるNext.jsを選定しました。

またVercelへのデプロイと組み合わせると、Vercelの自動キャッシュ機能を利用することができ、デプロイごとに静的ファイルを自動でキャッシュしてくれます。詳細↓

https://vercel.com/docs/edge-network/caching

SSGの場合、初回レンダリングやパフォーマンスの面でも優れています。

軽く、SSGについて整理をします。

SSGの大きな特徴は、予めHTMLをレンダリングしておき、ユーザーからのリクエスト(画面遷移等)に応じて用意しておいたHTMLを返却するだけといったものです。

これがSSGで無い場合は、ユーザーからのリクエストの度にHTMLを生成して、それを返却する形式になっています。

今回はそのSSGで生成するHTMLを一部、Markdownからの変換されたHTMLでレンダリングするようにしています。

ブログ記事はMarkdownで記述し、所定のディレクトリに配置するだけでルーティングも良い感じにしてくれる実装を今回はしました。

## watsuyo.devのドメインはどうしたの？

domain.comで買いました。

欲しいドメイン名は初めから決めていたので、国内外のドメイン販売サービスを比較しながら一番安い所で買いました。

GitHubにmainブランチをPushすると、予め連携しておいたVercelのプロジェクトにDeployされます。

後はVecelとdomain.comにIPアドレスを設定するだけで、watsuyo.devにアクセスできます。

## 本題

### ローカルにプロジェクトを作成する

まずはローカルにNext.jsのプロジェクトを作成します。

今回はTypeScriptを使いたいので、TypeScriptのoptionをつけます。

```bash
$ yarn create next-app --typescript
```

デフォルトではpagesディレクトリがsrcディレクトリに入っていないので、srcディレクトリに移動をし、tsconfig.jsにあるエイリアスの設定も変更します。

```json
"compilerOptions": {
	"baseUrl": "src"
}
```

src以下は、現段階では以下のような構成になります。

src配下に配置するかしないかの判断基準は、画面実装に直接関係があるかで判断しています。

```
src
├── pages
│   ├── _app.tsx
│   ├── api
│   │   └── hello.ts
│   └── index.tsx
└── styles
    ├── Home.package.css
    └── globals.css
```

今後、共通コンポーネント作成した時には `components`といったディレクトリ配下にコンポーネントを配置して、`components`もsrc配下に配置するのが妥当かと思います。

以下は、今回の最終目標的な構成になります。

```
src
├── Head.tsx
├── components
│   ├── Footer.tsx
│   ├── Header.tsx
│   └── styled
│       ├── PostContainer.ts
│       ├── StyledAnchorLink.ts
│       ├── StyledCard.ts
│       └── StyledLink.ts
├── global.ts
├── logic
│   ├── getAllPosts.ts
│   └── style.ts
├── pages
│   ├── _app.tsx
│   ├── _documents.tsx
│   ├── blog
│   │   ├── [title].tsx
│   │   └── sample-blog
│   │       └── index.mdx
│   ├── index.tsx
└── type.ts
```

プロジェクト作成ができたら

```bash
$ yarn dev
```

でローカルサーバーを立ち上げます。

立ち上がったらブラウザで確認してみると、以下のような画面が表示されると思います。

![http://localhost:3000/](https://i.gyazo.com/731048b56c77bb2cc75491013675900a.png)

ひとまず、ブログを作る第一歩は完成しました。

適宜、commitをしておきましょう

次はpackageです。

初期の段階で以下のようなpackage.jsonになっていると思うので

```json
{
  略
  "dependencies": {
    "next": "11.1.2",
    "react": "17.0.2",
    "react-dom": "17.0.2"
  },
  "devDependencies": {
    "@types/react": "17.0.21",
    "eslint": "7.32.0",
    "eslint-config-next": "11.1.2",
    "typescript": "4.4.3"
  }
}
```

今回の開発で必要になるyarn packageをインストールします。

```json
{
　略
  "dependencies": {
    + "@emotion/styled": "^11.3.0",
    + "@theme-ui/presets": "^0.11.2",
    + "gray-matter": "^4.0.3",
    "next": "11.1.2",
    + "next-mdx-enhanced": "^5.0.0",
    + "next-mdx-remote": "^3.0.4",
    "react": "17.0.2",
    "react-dom": "17.0.2",
    + "react-icons": "^4.2.0",
    + "theme-ui": "^0.11.2"
  },
  "devDependencies": {
    "@types/react": "17.0.21",
    + "@typescript-eslint/eslint-plugin": "^4.30.0",
    + "@typescript-eslint/parser": "^4.30.0",
    + "babel-plugin-emotion": "^11.0.0",
    "eslint": "^7.32.0",
    "eslint-config-next": "11.1.2",
    + "eslint-config-prettier": "^8.3.0",
    + "eslint-plugin-react": "^7.25.1",
    + "eslint-plugin-react-hooks": "^4.2.0",
    + "prettier": "2.4.1",
    "typescript": "4.4.3"
  }
}
```

Markdownで書いたブログをHTML化するためにMDX関係のpackageを追加します。
今回はNextが提供している @next/mdx ではなく、next-mdx-enhanced を使用します。
[next-mdx-enhanced](https://github.com/hashicorp/next-mdx-enhanced)は、Next.jsがMDXを読み込んでHTML化してくれます。

[gray-matter](https://github.com/jonschlinkert/gray-matter)は、yaml形式で記述したブログの情報をJSオブジェクト形式に変換してくれます。

以下のようにブログの情報をymlで記述できます。

```md
---
title: 'Next.jsとMDXで個人ブログを作ってみた'
date: '2021/09/18'
description: 'コンテンツの内容'
---

# 本文
```

[next-mdx-remote](https://github.com/hashicorp/next-mdx-remote)は、getServerPropsやgetStaticPropsによって、Markdownを読み込むためのものです。

```bash
$ yarn next-mdx-enhanced next-mdx-remote gray-matter
```

今回は[@emotion/styled](https://github.com/emotion-js/emotion)を使用して、スタイルを当てたいと思います。

```bash
$ yarn add @emotion/styled
```

ダークモードを実装するのとPrismを使って、コードのsyntax highlightingを利用したいので、[theme-ui](https://github.com/system-ui/theme-ui)を追加します。

```bash
$ yarn add theme-ui @theme-ui/presets
```

Reactでiconを使いたいときはiconをコンポーネントとしてimportできる、[react-icons](https://github.com/react-icons/react-icons)が便利です。

```bash
$ yarn add react-icons
```

今回、開発で必要なyarn packageは以上ですが、お好みでESLintやprettierの設定をすると、開発体験を向上できるかと思います。

packageを入れ終わったら再度、yarn devで正しく表示されているかを確認してみましょう。

画面を更新するようなことはしていないと思うので、先ほどと同じ画面が表示されるはずです。

1つの記事で全て書き切ろうと思いましたが、ここまでかなりのボリュームになったので、続きは次回のブログにしようかなと思います。

次は早速、Markdownで書いたブログをHTML化して表示させてみます。

## 参考
- [Next.jsで作る技術ブログ [Part1 - セットアップ]](https://youtu.be/5obR4PzQObI)
- [Next.js + MDXでブログを作った](https://titanicrising.jp/blog/nextjs-mdx)
- [Next.js でブログを作り直した](https://queq1890.info/blog/new-blog)
- [Next.js + MDXでブログを作る 〜 Blanktarの場合](https://blanktar.jp/blog/2020/05/how-to-make-blog-with-nextjs)
- [Next.js + MDX で自分用ブログシステムを再構築した](https://blog.fohte.net/posts/2020-06-07-next-js-mdx)
